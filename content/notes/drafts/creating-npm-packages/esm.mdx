---
title: ES modules
description: How do ES modules work?
tags:
  - drafts
---

This posts gives an overivew of how CommonJS modules work.

[ES modules: A cartoon deep-dive](https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/)

- With ES modules you need to create a graph of instances in 3 steps:
  1. **Construction:** find, download and parse files. Build module records and
     module map.
     1. _Module resolution:_ where is the module located?
     1. _Fetch:_ download or load from file system. Browsers currently support
        URLs as module specifier only.
     1. _Parse:_ figure out imports and exports and create a module record, then
        put module record in a module map using the module specifier as key
        (similar to how Webpack does this).
  1. **Instantiation:** find boxes in memory for exported values, then link
     imports and exports to these boxes. Create module graph.
  1. **Evaluation:** evaluate boxes with actual values.
- In browsers you load the first module with a script tag:
  `<script src="main.js" type="module" />`. But then what module specifiers
  should you use inside `main.js` so a browser still knows what to do? You still
  need a [bundler](/notes/dev/bundlers).
- Starting with v12, Node supports ES modules. Module specifiers point to files.
